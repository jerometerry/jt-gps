<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
	<head>
		<style type="text/css">
			#map_canvas {
				margin: 0;
				padding: 0;
				width: 800px;
				height: 600px;
				margin-right: auto;
				margin-left: auto;
			}
		</style>
		
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
		<script src="http://maps.googleapis.com/maps/api/js?sensor=false" type="text/javascript"></script>
		
		<script type="text/javascript">

			google.maps.event.addDomListener(window, 'load', mapLoaded);
			var canvas = null;
			var map = null;
            var currentMarker = null;
			
			function mapLoaded() {
				var myOptions = {
					zoom: 8,
					center: new google.maps.LatLng(-34.397, 150.644),
					disableDefaultUI: false,
					mapTypeId: google.maps.MapTypeId.ROADMAP
				};

				canvas = document.getElementById('map_canvas');
				map = new google.maps.Map(canvas, myOptions);
			}

			$(document).ready(function () {
			    $.ajax({
			        url: "http://localhost:183/CurrentGpsCoordinates",
			        dataType: 'json',
			        data: {},
			        success: function (data) {
			            if (data != null) {
			                var loc = new google.maps.LatLng(data.Latitude, data.Longitude);
			                setCenter(loc);
			                addMarker(loc, data.Latitude + ", " + data.Longitude);
			            }
			        },
			        error: function (jqXHR, textStatus, errorThrown) {
			        },
			        complete: function () {
			        }
			    });
			});

            function addMarker(location, title) {
                if (currentMarker != null) {
                    currentMarker.setMap(null);
                }

                if (map != null) {
                    currentMarker = new google.maps.Marker({
                        position: location,
                        map: map,
                        title: title
                    });
                }
            }

            function setCenter(location) {
                if (map != null) {
                    map.setCenter(location);
                }
            }
		</script>
	</head>
	
	<body>
		<div id="messageDiv"></div>
        <div id="map_canvas"></div>


	</body>
</html>